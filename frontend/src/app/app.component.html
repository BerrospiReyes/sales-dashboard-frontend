<div class="dashboard-wrapper">
  <header class="main-header">
    <div class="left-content-group">
      <div class="filter-item">
        <label>Categor√≠a</label>
        <select [(ngModel)]="filter.category" (change)="onCategoryChange()">
          <option value="">Seleccionar...</option>
          <option value="Agua">Agua</option>
          <option value="Gaseosa">Gaseosa</option>
        </select>
      </div>
      
      <div class="filter-item">
        <label>Marca</label>
        <select [(ngModel)]="filter.brand" (change)="loadData()" [disabled]="!filter.category">
          <option value="">Seleccionar...</option>
          <option *ngFor="let b of filteredBrands" [value]="b">{{ b }}</option>
        </select>
      </div>

      <div class="brand-badge" *ngIf="filter.brand">
        <div class="vertical-divider"></div>
        <img [src]="brandLogos[filter.brand]" alt="logo">
        <div class="brand-text">
          <span class="tiny-label">Editanto datos de </span>
          <span class="brand-name">{{ filter.brand }}</span>
        </div>
      </div>
    </div>
  </header>

  <section class="table-section">
    <table class="compact-table">
      <thead>
        <tr>
          <th class="sticky-col">M√©tricas de Gesti√≥n</th>
          <th *ngFor="let m of months">{{ m }}</th>
        </tr>
      </thead>
      <tbody>
        <tr class="section-divider">
          <td colspan="13">GESTI√ìN DE VOLUMEN (UNIDADES)</td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Cantidad Vendida</td>
          <td *ngFor="let m of months">
            <input type="number" [(ngModel)]="tableData[m].quantity" class="cell-input">
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Meta de Cantidad</td>
          <td *ngFor="let m of months">
            <input type="number" [(ngModel)]="tableData[m].goalQty" class="cell-input">
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Ganancia/Falta</td>
          <td *ngFor="let m of months" class="bold" [ngClass]="getQtyProfit(m) >= 0 ? 'text-success' : 'text-danger'">
            {{ getQtyProfit(m) > 0 ? "+" : "" }}{{ getQtyProfit(m) | number: "1.0-0" }}
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Varianza %</td>
          <td *ngFor="let m of months" class="bold" [style.color]="getQtyVariation(m) >= 0 ? '#10b981' : '#ef4444'">
            {{ getQtyVariation(m) | number: "1.0-1" }}%
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Score</td>
          <td *ngFor="let m of months">
            <span class="score-pill-mini" [style.background]="getQtyScore(m) >= 100 ? '#10b981' : '#64748b'">
              {{ getQtyScore(m) | number: "1.0-0" }}%
            </span>
          </td>
        </tr>

        <tr class="section-divider blue">
          <td colspan="13">GESTI√ìN DE INGRESOS (SOLES)</td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Precio Unitario</td>
          <td *ngFor="let m of months">
            <div class="input-with-symbol">
              <span class="symbol">S/</span>
              <input type="number" [(ngModel)]="tableData[m].price" class="cell-input">
            </div>
          </td>
        </tr>
        <tr class="highlight-row">
          <td class="row-label sticky-col">Venta Bruta</td>
          <td *ngFor="let m of months" class="bold">
            <span class="currency-label">S/</span>{{ (tableData[m].quantity * tableData[m].price || 0) | number: "1.0-0" }}
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Meta Precio</td>
          <td *ngFor="let m of months">
            <div class="input-with-symbol">
              <span class="symbol">S/</span>
              <input type="number" [(ngModel)]="tableData[m].goalAmt" class="cell-input">
            </div>
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Ganancia/Falta</td>
          <td *ngFor="let m of months" class="bold" [ngClass]="getAmtProfit(m) >= 0 ? 'text-success' : 'text-danger'">
            S/ {{ getAmtProfit(m) | number: "1.0-0" }}
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Varianza %</td>
          <td *ngFor="let m of months" class="bold" [style.color]="getVariation(m) >= 0 ? '#10b981' : '#ef4444'">
            {{ getVariation(m) | number: "1.0-1" }}%
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Score</td>
          <td *ngFor="let m of months">
            <span class="score-pill-mini" [style.background]="getScore(m) >= 100 ? '#10b981' : '#f59e0b'">
              {{ getScore(m) | number: "1.0-0" }}%
            </span>
          </td>
        </tr>
        <tr>
          <td class="row-label sticky-col">Acci√≥n</td>
          <td *ngFor="let m of months">
            <button class="btn-icon" (click)="saveRow(m)">üíæ</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <section class="chart-section-compact">
    <div class="chart-header">
      <div class="chart-controls-column"> 
        <span class="chart-title">An√°lisis Visual Histograma</span>
        
        <div class="chart-filters">
          <div class="filter-item-inline">
            <label>Categor√≠a:</label>
            <select [(ngModel)]="chartViewFilter.category" (change)="renderHistogram()">
              <option value="Todas">Todas las categor√≠as</option>
              <option value="Agua">Agua</option>
              <option value="Gaseosa">Gaseosa</option>
            </select>
          </div>
          
          <div class="filter-item-inline">
            <label>M√©trica:</label>
            <select [(ngModel)]="chartViewFilter.metric" (change)="renderHistogram()">
              <option value="Cantidad">Cantidad (Unidades)</option>
              <option value="Venta">Venta Bruta (S/)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div id="histogram-container"></div>
  </section>
</div>